# 双色球数据分析与预测系统使用文档

## 目录

1. [系统简介](#系统简介)
2. [安装配置](#安装配置)
3. [基本使用流程](#基本使用流程)
4. [功能详解](#功能详解)
   - [数据爬取](#数据爬取)
   - [基础分析](#基础分析)
   - [高级分析](#高级分析)
   - [智能预测](#智能预测)
   - [号码生成](#号码生成)
   - [查看最新开奖](#查看最新开奖)
5. [常见问题](#常见问题)
6. [进阶使用](#进阶使用)

## 系统简介

双色球数据分析与预测系统是一个集数据爬取、分析、预测于一体的综合工具，旨在帮助用户分析双色球历史数据，发现潜在规律，并提供智能预测功能。系统采用Python开发，提供命令行界面，支持多种分析方法和预测策略。

## 安装配置

### 环境要求

- Python 3.8 或更高版本
- 操作系统：Windows/macOS/Linux

### 安装步骤

1. **获取代码**

   通过下载ZIP包或使用Git克隆的方式获取项目代码：

   ```bash
   git clone <项目地址>
   cd ssq
   ```

2. **安装依赖**

   使用pip安装所需的依赖包：

   ```bash
   pip install -r requirements.txt
   ```

   注意：如果需要使用贝叶斯分析功能，请确保安装了PyMC和arviz包。

3. **验证安装**

   运行以下命令验证安装是否成功：

   ```bash
   python src/main.py
   ```

   如果显示帮助信息，则表示安装成功。

## 基本使用流程

使用本系统的基本流程如下：

1. **爬取数据**：首先获取双色球历史开奖数据
2. **分析数据**：对获取的数据进行基础分析或高级分析
3. **预测/生成号码**：基于分析结果预测或生成号码
4. **查看结果**：查看分析结果和预测号码

## 功能详解

### 数据爬取

数据爬取功能从中国福利彩票官方网站和500彩票网获取双色球历史开奖数据。

#### 基本用法

```bash
# 爬取最近300期数据（默认）
python src/main.py crawl

# 爬取所有历史数据
python src/main.py crawl --all

# 爬取指定期数的数据
python src/main.py crawl --count 100
```

#### 参数说明

- `--count`：指定要爬取的期数，默认为300期
- `--all`：爬取所有历史数据，从2003年第1期开始

#### 数据存储

爬取的数据将保存在`data`目录下：
- `ssq_data.csv`：最近300期数据（或指定期数）
- `ssq_data_all.csv`：所有历史数据（使用`--all`参数时）

### 基础分析

基础分析功能对双色球历史数据进行基本的统计分析，生成可视化图表。

#### 基本用法

```bash
python src/main.py analyze
```

#### 分析内容

- **号码频率分析**：分析红球和蓝球的出现频率
- **号码组合特征分析**：分析红球和值、奇偶比、大小比等特征
- **号码走势分析**：分析最近50期红球和蓝球的走势

#### 分析结果

分析结果将以图表形式保存在`data`目录下：
- `number_frequency.png`：号码频率图
- `number_combinations.png`：号码组合特征图
- `red_ball_trend.png`：红球走势图
- `blue_ball_trend.png`：蓝球走势图

### 高级分析

高级分析功能使用统计学、概率论、机器学习等方法对双色球数据进行深度分析。

#### 基本用法

```bash
# 运行所有高级分析
python src/main.py advanced --method all

# 运行特定分析方法
python src/main.py advanced --method stats
```

#### 分析方法

- `stats`：统计特性分析
- `probability`：概率分布分析
- `frequency`：频率模式分析
- `decision_tree`：决策树分析
- `cycle`：周期分析
- `bayes`：贝叶斯分析（需要安装PyMC和arviz）
- `correlation`：历史关联性分析
- `issue_correlation`：期号关联性分析

#### 参数说明

- `--method`：指定分析方法，默认为`all`
- `--periods`：分析期数，默认为300期
- `--save_model`：是否保存训练好的模型
- `--correlation_periods`：分析历史关联性的期数间隔，用逗号分隔，默认为`5,10,50,100`

#### 分析结果

分析结果将保存在`data/advanced`目录下，包括CSV数据文件和可视化图表。

### 智能预测

智能预测功能基于多种算法预测双色球号码。

#### 基本用法

```bash
# 使用默认方法（集成方法）预测
python src/main.py predict

# 使用特定方法预测
python src/main.py predict --method stats

# 生成多注号码
python src/main.py predict --count 5

# 解释预测结果
python src/main.py predict --explain

# 与历史数据对比
python src/main.py predict --compare
```

#### 预测方法

- `ensemble`：集成方法（默认）
- `stats`：基于统计特性
- `probability`：基于概率分布
- `decision_tree`：基于决策树
- `bayes`：基于贝叶斯分析
- `pattern`：基于模式识别

#### 参数说明

- `--method`：预测方法，默认为`ensemble`
- `--count`：生成注数，默认为1注
- `--explain`：是否解释预测结果
- `--compare`：是否与历史数据进行对比分析
- `--compare_periods`：与历史数据对比的期数，默认为300期

## 🆕 新增预测方法

基于全网开源项目分析，我们为您的双色球预测系统整合了5种核心预测方法，形成了业界最全面的预测系统。

### 1. LSTM深度学习预测器 🧠

基于TensorFlow + Keras LSTM网络的时间序列深度学习预测。

#### 基本用法

```bash
# 训练LSTM模型
python src/main.py lstm --train -p 500

# 预测1注号码
python src/main.py lstm -n 1

# 预测5注号码
python src/main.py lstm -n 5

# 重新训练模型
python src/main.py lstm --retrain -p 300
```

#### 技术特点

- **多窗口训练**: 支持3、5、7等多种窗口尺寸
- **CPU/GPU自适应**: 自动选择最优计算方式
- **双向LSTM**: 复杂模型使用双向LSTM网络
- **早停机制**: 防止过拟合，提高泛化能力

#### 参数说明

- `--train`: 训练LSTM模型
- `--retrain`: 重新训练LSTM模型
- `-p, --periods`: 训练期数，默认500期
- `--red_epochs`: 红球训练轮数，默认50
- `--blue_epochs`: 蓝球训练轮数，默认50
- `-n, --num`: 预测注数，默认1注

### 2. 集成学习预测器 🤖

基于XGBoost + LightGBM + Random Forest + Gradient Boosting的多模型融合预测。

#### 基本用法

```bash
# 训练集成模型
python src/main.py ensemble --train -p 500

# 预测1注号码
python src/main.py ensemble -n 1

# 预测多注号码
python src/main.py ensemble -n 3
```

#### 技术特点

- **多模型融合**: 4种集成学习算法投票
- **特征工程**: 频率、统计、序列、分布等多维特征
- **自动调参**: 自适应参数优化
- **投票机制**: 多模型投票选择最终结果

#### 参数说明

- `--train`: 训练集成学习模型
- `-p, --periods`: 训练期数，默认500期
- `-n, --num`: 预测注数，默认1注

### 3. 蒙特卡洛模拟预测器 🎲

基于概率分布建模 + 随机采样 + 自助法的统计预测。

#### 基本用法

```bash
# 蒙特卡洛预测
python src/main.py monte_carlo -n 1

# 自定义模拟次数
python src/main.py monte_carlo -n 3 -s 20000

# 进行模式分析并保存结果
python src/main.py monte_carlo -n 1 --analyze --save
```

#### 技术特点

- **概率分布建模**: 频率、间隔、模式多维分析
- **时间衰减权重**: 近期数据权重更高
- **蒙特卡洛模拟**: 10,000次随机采样
- **置信区间**: 自助法计算预测置信度

#### 参数说明

- `-n, --num`: 预测注数，默认1注
- `-s, --simulations`: 模拟次数，默认10000次
- `--analyze`: 进行模式分析
- `--save`: 保存分析结果

### 4. K-Means聚类分析预测器 🔍

基于K-Means + DBSCAN + PCA降维的模式识别预测。

#### 基本用法

```bash
# 聚类分析预测
python src/main.py clustering -n 1

# 自定义聚类数
python src/main.py clustering -n 3 -k 10

# 生成可视化图表并保存结果
python src/main.py clustering -n 1 --visualize --save
```

#### 技术特点

- **多维特征提取**: One-hot、统计、分布、连续性、尾数特征
- **自动聚类数**: 轮廓系数自动确定最优聚类数
- **双聚类算法**: K-Means + DBSCAN互补
- **模式识别**: 发现隐藏的号码组合模式

#### 参数说明

- `-n, --num`: 预测注数，默认1注
- `-k, --clusters`: 聚类数，默认自动确定
- `--visualize`: 生成聚类可视化图
- `--save`: 保存分析结果

### 5. 超级预测器 🌟

整合所有预测方法的智能融合系统。

#### 基本用法

```bash
# 集成预测（推荐）
python src/main.py super -m ensemble -n 3

# 快速预测
python src/main.py super -m quick -n 1

# 全方法预测
python src/main.py super -m all -n 2

# 方法对比
python src/main.py super -m compare -n 1

# 训练所有模型
python src/main.py super --train -p 500
```

#### 技术特点

- **全方法整合**: 整合所有5种预测方法
- **智能权重**: 根据算法准确性分配权重
- **多模式预测**: 快速、集成、全方法、对比模式
- **容错机制**: 单个算法失败不影响整体预测

#### 预测模式

- `ensemble`: 集成预测（推荐）- 加权投票融合所有方法
- `quick`: 快速预测 - 使用最快的可用方法
- `all`: 全方法预测 - 展示所有方法的结果
- `compare`: 方法对比 - 对比分析不同方法的特点

#### 参数说明

- `-m, --mode`: 预测模式，默认为ensemble
- `-n, --num`: 预测注数，默认1注
- `--train`: 训练所有模型
- `-p, --periods`: 训练期数，默认500期
- `--save`: 保存预测结果

#### 算法权重配置

在超级预测器中，各算法的默认权重为：

| 算法 | 权重 | 说明 |
|------|------|------|
| 混合分析 | 30% | 原有的7种数学模型综合 |
| LSTM深度学习 | 25% | 时间序列深度学习 |
| 集成学习 | 20% | XGBoost等多模型融合 |
| 蒙特卡洛模拟 | 15% | 概率分布随机采样 |
| 聚类分析 | 10% | 模式识别和聚类 |

## 🎯 推荐使用方式

### 日常预测（最推荐）
```bash
# 超级预测器集成模式
python src/main.py super -m ensemble -n 5
```

### 快速预测
```bash
# 超级预测器快速模式
python src/main.py super -m quick -n 3
```

### 深度分析
```bash
# 全方法对比分析
python src/main.py super -m compare -n 1
```

### 专项预测
```bash
# LSTM深度学习预测
python src/main.py lstm -n 3

# 蒙特卡洛模拟预测
python src/main.py monte_carlo -n 3 -s 20000

# 聚类分析预测
python src/main.py clustering -n 3
```

### 号码生成

号码生成功能提供多种策略生成双色球号码。

#### 基本用法

```bash
# 使用默认方法（混合策略）生成号码
python src/main.py generate

# 使用特定方法生成号码
python src/main.py generate --method random
```

#### 生成方法

- `hybrid`：混合策略（默认）
- `random`：纯随机
- `frequency`：基于频率
- `trend`：基于走势

#### 参数说明

- `--method`：生成方法，默认为`hybrid`

### 查看最新开奖

查看最新一期双色球开奖结果。

#### 基本用法

```bash
python src/main.py latest
```

## 常见问题

### 1. 爬取数据失败

**问题**：运行爬虫命令时出现错误，无法获取数据。

**解决方案**：
- 检查网络连接是否正常
- 尝试使用`--all`参数，系统会尝试从多个数据源获取数据
- 如果官方网站返回403错误，可能是因为访问频率过高，请稍后再试

### 2. 高级分析功能不可用

**问题**：运行高级分析命令时提示"高级分析模块不可用"。

**解决方案**：
- 确保已安装所有依赖：`pip install -r requirements.txt`
- 对于贝叶斯分析，需要额外安装PyMC和arviz：`pip install pymc arviz`

### 3. 分析结果图表中文显示为乱码

**问题**：生成的图表中，中文标题或标签显示为乱码。

**解决方案**：
- 确保系统中安装了中文字体
- 在Windows系统中，确保安装了SimHei字体
- 在macOS系统中，确保安装了Hiragino Sans GB字体
- 在Linux系统中，确保安装了WenQuanYi Micro Hei字体

## 进阶使用

### 自定义分析

如果您想进行自定义分析，可以直接使用项目中的模块：

```python
from src.cwl_crawler import SSQCWLCrawler
from src.analyzer import SSQAnalyzer
from src.advanced_analyzer import SSQAdvancedAnalyzer

# 创建爬虫实例并获取数据
crawler = SSQCWLCrawler()
results = crawler.get_history_data()

# 创建分析器实例并进行分析
analyzer = SSQAnalyzer(data_file="path/to/data.csv")
analyzer.run_analysis()

# 创建高级分析器实例并进行分析
advanced_analyzer = SSQAdvancedAnalyzer(data_file="path/to/data.csv")
advanced_analyzer.run_advanced_analysis()
```

### 批量预测

如果您想进行批量预测并评估准确率，可以使用以下方法：

```python
from src.advanced_analyzer import SSQAdvancedAnalyzer

# 创建高级分析器实例
analyzer = SSQAdvancedAnalyzer(data_file="path/to/data.csv")

# 批量预测
predictions = []
for i in range(10):
    numbers = analyzer.predict_numbers(method="ensemble")
    predictions.append(numbers)

# 打印预测结果
for i, pred in enumerate(predictions):
    red_balls = pred[:6]
    blue_ball = pred[6]
    print(f"预测{i+1}: 红球: {red_balls}, 蓝球: {blue_ball}")
```

### 自定义数据源

如果您想添加新的数据源，可以扩展`SSQCWLCrawler`类：

```python
class CustomSSQCrawler(SSQCWLCrawler):
    def __init__(self, data_dir="../data"):
        super().__init__(data_dir)
        self.custom_url = "https://example.com/ssq_data"
    
    def get_history_data_from_custom_source(self):
        # 实现自定义数据源的爬取逻辑
        results = []
        # ...
        return results
    
    def get_history_data(self, count=None):
        # 先尝试从官方网站获取
        results = super().get_history_data(count)
        
        # 如果数据不足，尝试从自定义数据源获取
        if len(results) < (count or 300):
            custom_results = self.get_history_data_from_custom_source()
            # 合并数据并去重
            # ...
        
        return results
```

---

本文档提供了双色球数据分析与预测系统的详细使用说明。如有更多问题，请参考项目源代码或提交问题反馈。